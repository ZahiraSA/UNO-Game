<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNO Card Game - Enhanced Edition</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&family=Nunito:wght@400;600;700;800;900&display=swap');
        
        :root {
            --animation-duration: 0.4s;
            --primary-red: #dc143c;
            --dark-red: #8b0000;
            --card-shadow: 0 6px 20px rgba(0,0,0,0.3);
            --glow-effect: 0 0 20px rgba(255,255,255,0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: radial-gradient(ellipse at center, var(--primary-red) 0%, var(--dark-red) 70%, #2d0000 100%);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Enhanced Background */
        .background-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(255,255,255,0.1) 2px, transparent 2px),
                radial-gradient(circle at 75% 75%, rgba(255,255,0,0.1) 2px, transparent 2px),
                radial-gradient(circle at 25% 75%, rgba(0,255,0,0.1) 2px, transparent 2px),
                radial-gradient(circle at 75% 25%, rgba(0,100,255,0.1) 2px, transparent 2px);
            background-size: 50px 50px;
            animation: patternFloat 20s linear infinite;
        }

        @keyframes patternFloat {
            0% { transform: translateX(0) translateY(0); }
            100% { transform: translateX(-50px) translateY(-50px); }
        }

        .uno-logo-bg {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 15rem;
            color: rgba(139, 0, 0, 0.1);
            font-family: 'Fredoka One', cursive;
            z-index: -1;
            pointer-events: none;
            animation: logoBreath 8s ease-in-out infinite;
        }

        @keyframes logoBreath {
            0%, 100% { opacity: 0.1; transform: translate(-50%, -50%) scale(1); }
            50% { opacity: 0.2; transform: translate(-50%, -50%) scale(1.05); }
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #000000, #2d0000, #8b0000);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.5s ease;
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 8px solid rgba(255,255,255,0.2);
            border-top: 8px solid #ff0000;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 30px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: white;
            font-size: 1.5rem;
            font-weight: 800;
            animation: loadingPulse 2s ease-in-out infinite;
        }

        @keyframes loadingPulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        .game-container {
            position: relative;
            z-index: 1;
        }

        /* Game Timer */
        .game-timer {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 15px 25px;
            border-radius: 20px;
            font-weight: 800;
            font-size: 1.2rem;
            z-index: 100;
            border: 2px solid #ff0000;
            backdrop-filter: blur(10px);
        }

        /* Enhanced Menu Screen */
        .menu-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .logo {
            font-family: 'Fredoka One', cursive;
            font-size: 5rem;
            background: linear-gradient(45deg, #ff0000, #ffff00, #0000ff, #00ff00);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(255,255,255,0.5);
            margin-bottom: 2rem;
            animation: logoRainbow 3s ease-in-out infinite, logoFloat 6s ease-in-out infinite;
            letter-spacing: 8px;
        }

        @keyframes logoRainbow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        @keyframes logoFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 25px;
            margin-bottom: 2rem;
        }

        .btn {
            padding: 18px 45px;
            font-size: 1.3rem;
            font-weight: 800;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all var(--animation-duration) ease;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            overflow: hidden;
            box-shadow: var(--card-shadow);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: all 0.6s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ff4757, #ff3838);
            color: white;
            border: 3px solid #ffffff;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #2ed573, #1dd1a1);
            color: white;
            border: 3px solid #ffffff;
        }

        .btn-info {
            background: linear-gradient(135deg, #3742fa, #2f3542);
            color: white;
            border: 3px solid #ffffff;
        }

        .btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
        }

        /* Enhanced Level Selector */
        .level-selector {
            background: rgba(0,0,0,0.9);
            padding: 40px;
            border-radius: 25px;
            backdrop-filter: blur(15px);
            margin: 20px 0;
            border: 3px solid #ff0000;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .level-title {
            color: white;
            font-size: 2rem;
            font-weight: 900;
            margin-bottom: 30px;
            text-align: center;
            text-shadow: 0 0 20px rgba(255,0,0,0.8);
            animation: titlePulse 3s ease-in-out infinite;
        }

        @keyframes titlePulse {
            0%, 100% { text-shadow: 0 0 20px rgba(255,0,0,0.8); }
            50% { text-shadow: 0 0 40px rgba(255,0,0,1), 0 0 60px rgba(255,255,0,0.5); }
        }

        .level-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .level-option {
            background: linear-gradient(135deg, rgba(255,0,0,0.3), rgba(139,0,0,0.5));
            border: 3px solid transparent;
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all var(--animation-duration) ease;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .level-option::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #ff0000, #ffff00, #00ff00, #0000ff);
            border-radius: 20px;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .level-option:hover, .level-option.selected {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 40px rgba(255,0,0,0.4);
        }

        .level-option:hover::before, .level-option.selected::before {
            opacity: 1;
        }

        .level-name {
            color: white;
            font-weight: 800;
            font-size: 1.4rem;
            margin-bottom: 15px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.8);
        }

        .level-desc {
            color: rgba(255,255,255,0.9);
            font-size: 1.1rem;
            font-weight: 600;
            line-height: 1.4;
        }

        /* Settings Screen */
        .settings-screen {
            display: none;
            min-height: 100vh;
            padding: 40px 20px;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(15px);
        }

        .settings-title {
            color: white;
            font-size: 2.5rem;
            font-weight: 900;
            text-align: center;
            margin-bottom: 40px;
            text-shadow: 0 0 20px rgba(255,0,0,0.8);
        }

        .settings-group {
            max-width: 800px;
            margin: 0 auto 30px;
            background: rgba(255,255,255,0.1);
            padding: 25px;
            border-radius: 20px;
            border: 2px solid rgba(255,0,0,0.3);
        }

        .settings-label {
            color: white;
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 15px;
            display: block;
        }

        .settings-control, .volume-control {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: 2px solid #ff0000;
            background: rgba(0,0,0,0.8);
            color: white;
            font-size: 1rem;
        }

        .volume-control {
            -webkit-appearance: none;
            height: 8px;
            background: linear-gradient(90deg, #ff0000, #ffff00, #00ff00);
            outline: none;
        }

        .volume-control::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        /* Enhanced Game Screen */
        .game-screen {
            display: none;
            min-height: 100vh;
            padding: 20px;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            background: rgba(0,0,0,0.9);
            padding: 20px 30px;
            border-radius: 20px;
            backdrop-filter: blur(15px);
            border: 2px solid #ff0000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .game-info {
            display: flex;
            gap: 40px;
            align-items: center;
        }

        .info-item {
            text-align: center;
            color: white;
            position: relative;
        }

        .info-item::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, #ff0000, transparent);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .info-item:hover::after {
            opacity: 1;
        }

        .info-label {
            font-size: 1rem;
            opacity: 0.8;
            margin-bottom: 8px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .info-value {
            font-size: 1.8rem;
            font-weight: 900;
            text-shadow: 0 2px 10px rgba(255,0,0,0.8);
            transition: all 0.3s ease;
        }

        .info-value.highlight {
            animation: valueHighlight 1s ease-in-out;
        }

        @keyframes valueHighlight {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); color: #ffff00; }
        }

        /* Enhanced Game Board */
        .game-board {
            display: grid;
            grid-template-columns: 1fr 350px 1fr;
            gap: 40px;
            max-width: 1500px;
            margin: 0 auto;
        }

        .opponent-area, .player-area {
            text-align: center;
        }

        .opponent-label, .player-label {
            color: white;
            font-size: 1.3rem;
            font-weight: 800;
            margin-bottom: 20px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.8);
            padding: 10px 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,100,0,0.3);
        }

        .opponent-label {
            background: rgba(255,100,0,0.2);
        }

        .player-label {
            background: rgba(0,255,100,0.2);
            border-color: rgba(0,255,100,0.3);
        }

        .opponent-cards {
            display: flex;
            justify-content: center;
            gap: -5px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            perspective: 1000px;
        }

        /* Enhanced Card Back */
        .card-back {
            width: 70px;
            height: 105px;
            background: linear-gradient(135deg, #000080 0%, #4169e1 50%, #000080 100%);
            border-radius: 12px;
            border: 3px solid #ffffff;
            box-shadow: var(--card-shadow);
            position: relative;
            margin-left: -10px;
            transition: all var(--animation-duration) ease;
            cursor: pointer;
            transform-style: preserve-3d;
        }

        .card-back:hover {
            transform: translateY(-8px) scale(1.05) rotateY(15deg);
            z-index: 10;
            box-shadow: 0 15px 40px rgba(0,0,0,0.5);
        }

        .card-back::before {
            content: '';
            position: absolute;
            top: 8px;
            left: 8px;
            right: 8px;
            bottom: 8px;
            border-radius: 8px;
            background: 
                radial-gradient(ellipse at center, #ff0000 20%, transparent 50%),
                radial-gradient(ellipse at 30% 30%, #ffff00 15%, transparent 40%),
                radial-gradient(ellipse at 70% 70%, #00ff00 15%, transparent 40%),
                radial-gradient(ellipse at 30% 70%, #ff0000 15%, transparent 40%),
                radial-gradient(ellipse at 70% 30%, #0000ff 15%, transparent 40%);
        }

        .card-back::after {
            content: 'UNO';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg);
            color: #ffffff;
            font-family: 'Fredoka One', cursive;
            font-size: 14px;
            font-weight: 400;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            z-index: 2;
        }

        /* Enhanced Center Area */
        .center-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 25px;
        }

        /* Enhanced Current Card */
        .current-card {
            width: 140px;
            height: 210px;
            border-radius: 15px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.6);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            font-weight: 900;
            font-size: 2rem;
            color: white;
            text-shadow: 0 3px 6px rgba(0,0,0,0.8);
            position: relative;
            overflow: hidden;
            border: 4px solid #ffffff;
            animation: currentCardGlow 3s ease-in-out infinite alternate;
            transition: all var(--animation-duration) ease;
        }

        @keyframes currentCardGlow {
            0% { 
                box-shadow: 0 15px 40px rgba(0,0,0,0.6);
                transform: scale(1) rotateY(0deg);
            }
            100% { 
                box-shadow: 0 20px 60px rgba(255,255,255,0.3), 0 0 40px rgba(255,255,255,0.2);
                transform: scale(1.02) rotateY(2deg);
            }
        }

        .current-card::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            border-radius: 10px;
            border: 2px solid rgba(255,255,255,0.3);
            pointer-events: none;
        }

        .current-card .card-corners {
            position: absolute;
            font-size: 1.2rem;
            font-weight: 900;
        }

        .current-card .top-left {
            top: 8px;
            left: 8px;
        }

        .current-card .bottom-right {
            bottom: 8px;
            right: 8px;
            transform: rotate(180deg);
        }

        .current-card .main-symbol {
            font-size: 4.5rem;
            text-align: center;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.6));
            animation: symbolFloat 4s ease-in-out infinite;
        }

        @keyframes symbolFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-3px); }
        }

        /* Enhanced Draw Pile */
        .draw-pile {
            width: 120px;
            height: 180px;
            background: linear-gradient(135deg, #000080 0%, #4169e1 50%, #000080 100%);
            border-radius: 15px;
            border: 4px solid #ffffff;
            cursor: pointer;
            transition: all var(--animation-duration) ease;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            overflow: hidden;
        }

        .draw-pile:hover {
            transform: translateY(-8px) scale(1.1) rotateY(-15deg);
            box-shadow: 0 20px 50px rgba(0,0,0,0.6);
        }

        .draw-pile:active {
            transform: translateY(-5px) scale(1.05);
        }

        .draw-pile::before {
            content: '';
            position: absolute;
            top: 8px;
            left: 8px;
            right: 8px;
            bottom: 8px;
            border-radius: 10px;
            background: 
                radial-gradient(ellipse at center, #ff0000 20%, transparent 50%),
                radial-gradient(ellipse at 30% 30%, #ffff00 15%, transparent 40%),
                radial-gradient(ellipse at 70% 70%, #00ff00 15%, transparent 40%);
        }

        .draw-pile::after {
            content: 'DRAW';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ffffff;
            font-family: 'Fredoka One', cursive;
            font-size: 16px;
            font-weight: 400;
            text-shadow: 2px 2px 6px rgba(0,0,0,0.8);
            z-index: 2;
        }

        .player-cards {
            display: flex;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
            padding: 25px;
            background: rgba(0,0,0,0.8);
            border-radius: 25px;
            backdrop-filter: blur(15px);
            min-height: 160px;
            border: 2px solid #ff0000;
            box-shadow: inset 0 4px 15px rgba(255,0,0,0.2);
            perspective: 1000px;
        }

        /* Enhanced Player Cards */
        .card {
            width: 90px;
            height: 135px;
            border-radius: 12px;
            border: 3px solid #ffffff;
            cursor: pointer;
            transition: all var(--animation-duration) ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 8px;
            font-weight: 900;
            font-size: 1.4rem;
            color: white;
            text-shadow: 0 2px 6px rgba(0,0,0,0.8);
            position: relative;
            box-shadow: var(--card-shadow);
            overflow: hidden;
            transform-style: preserve-3d;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 6px;
            left: 6px;
            right: 6px;
            bottom: 6px;
            border-radius: 8px;
            border: 2px solid rgba(255,255,255,0.4);
            pointer-events: none;
        }

        .card:hover {
            transform: translateY(-15px) scale(1.1) rotateY(10deg);
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            z-index: 15;
        }

        .card.playable {
            animation: cardPulse 2s ease-in-out infinite;
            box-shadow: 0 6px 20px rgba(255,255,255,0.4);
        }

        .card.playable:hover {
            animation: cardPlayableHover 1s ease-in-out infinite;
        }

        .card.playing {
            animation: cardPlaying 0.8s ease-out forwards;
        }

        @keyframes cardPlaying {
            0% { transform: translateY(0) scale(1) rotateY(0deg); }
            50% { transform: translateY(-50px) scale(1.2) rotateY(180deg); }
            100% { transform: translateY(-100px) scale(0.8) rotateY(360deg) rotateX(90deg); opacity: 0; }
        }

        @keyframes cardPulse {
            0%, 100% { 
                box-shadow: 0 6px 20px rgba(255,255,255,0.4);
                border-color: #ffffff;
            }
            50% { 
                box-shadow: 0 10px 30px rgba(255,255,255,0.8), 0 0 20px rgba(255,255,255,0.6);
                border-color: #ffff00;
            }
        }

        @keyframes cardPlayableHover {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .card .card-corners {
            position: absolute;
            font-size: 0.9rem;
            font-weight: 900;
        }

        .card .top-left {
            top: 4px;
            left: 4px;
        }

        .card .bottom-right {
            bottom: 4px;
            right: 4px;
            transform: rotate(180deg);
        }

        .card .main-symbol {
            font-size: 3rem;
            text-align: center;
            filter: drop-shadow(0 3px 6px rgba(0,0,0,0.6));
            transition: all 0.3s ease;
        }

        .card:hover .main-symbol {
            transform: scale(1.1);
        }

        /* Enhanced UNO Card Colors */
        .card-red, .current-card.card-red {
            background: linear-gradient(135deg, #ff0000 0%, #cc0000 50%, #990000 100%);
        }

        .card-blue, .current-card.card-blue {
            background: linear-gradient(135deg, #0066ff 0%, #0000cc 50%, #000099 100%);
        }

        .card-green, .current-card.card-green {
            background: linear-gradient(135deg, #00cc00 0%, #009900 50%, #006600 100%);
        }

        .card-yellow, .current-card.card-yellow {
            background: linear-gradient(135deg, #ffcc00 0%, #ff9900 50%, #cc6600 100%);
            color: #000000 !important;
            text-shadow: 0 2px 6px rgba(255,255,255,0.8) !important;
        }

        .card-yellow .card-corners {
            color: #000000 !important;
            text-shadow: 0 1px 3px rgba(255,255,255,0.8) !important;
        }

        .card-wild, .current-card.card-wild {
            background: linear-gradient(135deg, #000000 0%, #333333 25%, #ff0000 50%, #ffff00 75%, #000000 100%);
            background-size: 400% 400%;
            animation: wildCardRainbow 3s ease-in-out infinite;
        }

        @keyframes wildCardRainbow {
            0%, 100% { background-position: 0% 50%; }
            25% { background-position: 100% 25%; }
            50% { background-position: 100% 100%; }
            75% { background-position: 0% 75%; }
        }

        /* Enhanced Action Buttons */
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 25px;
        }

        .game-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 20px;
            font-weight: 800;
            cursor: pointer;
            transition: all var(--animation-duration) ease;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: 3px solid #ffffff;
            position: relative;
            overflow: hidden;
        }

        .game-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: all 0.5s;
        }

        .game-btn:hover::before {
            left: 100%;
        }

        .btn-uno {
            background: linear-gradient(135deg, #ff0000, #ff6600);
            color: white;
            animation: unoButtonGlow 2s ease-in-out infinite alternate;
        }

        @keyframes unoButtonGlow {
            0% { 
                box-shadow: 0 6px 20px rgba(255, 0, 0, 0.4);
                transform: scale(1);
            }
            100% { 
                box-shadow: 0 12px 40px rgba(255, 0, 0, 0.8), 0 0 30px rgba(255, 0, 0, 0.6);
                transform: scale(1.05);
            }
        }

        .btn-pass {
            background: linear-gradient(135deg, #666666, #333333);
            color: white;
        }

        .game-btn:hover {
            transform: translateY(-3px) scale(1.05);
        }

        .game-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Enhanced Color Selector */
        .color-selector {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            padding: 40px;
            border-radius: 25px;
            box-shadow: 0 25px 80px rgba(0,0,0,0.8);
            z-index: 1000;
            backdrop-filter: blur(20px);
            border: 3px solid #ff0000;
            animation: colorSelectorAppear 0.5s ease-out;
        }

        @keyframes colorSelectorAppear {
            from { 
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5) rotate(180deg);
            }
            to { 
                opacity: 1;
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
            }
        }

        .color-selector h3 {
            text-align: center;
            margin-bottom: 30px;
            color: white;
            font-size: 1.5rem;
            font-weight: 800;
            animation: titlePulse 2s ease-in-out infinite;
        }

        .color-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .color-option {
            width: 100px;
            height: 100px;
            border-radius: 20px;
            border: 4px solid #ffffff;
            cursor: pointer;
            transition: all var(--animation-duration) ease;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            position: relative;
        }

        .color-option::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: inherit;
            filter: brightness(1.5);
        }

        .color-option:hover {
            transform: scale(1.2) rotate(15deg);
            box-shadow: 0 15px 40px rgba(0,0,0,0.5);
        }

        .color-option.red { 
            background: linear-gradient(135deg, #ff0000, #cc0000);
        }
        .color-option.blue { 
            background: linear-gradient(135deg, #0066ff, #0000cc);
        }
        .color-option.green { 
            background: linear-gradient(135deg, #00cc00, #009900);
        }
        .color-option.yellow { 
            background: linear-gradient(135deg, #ffcc00, #ff9900);
        }

        /* Win Screen */
        .win-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(20px);
        }

        .win-content {
            background: linear-gradient(135deg, rgba(255,0,0,0.2), rgba(139,0,0,0.4));
            padding: 50px;
            border-radius: 30px;
            text-align: center;
            border: 3px solid #ff0000;
            box-shadow: 0 30px 100px rgba(0,0,0,0.8);
            backdrop-filter: blur(15px);
            animation: winScreenAppear 1s ease-out;
        }

        @keyframes winScreenAppear {
            from { 
                opacity: 0;
                transform: scale(0.5) rotate(180deg);
            }
            to { 
                opacity: 1;
                transform: scale(1) rotate(0deg);
            }
        }

        .win-title {
            font-size: 3.5rem;
            font-weight: 900;
            color: white;
            margin-bottom: 20px;
            text-shadow: 0 0 30px rgba(255,255,0,0.8);
            animation: winTitlePulse 2s ease-in-out infinite;
        }

        @keyframes winTitlePulse {
            0%, 100% { 
                text-shadow: 0 0 30px rgba(255,255,0,0.8);
                transform: scale(1);
            }
            50% { 
                text-shadow: 0 0 50px rgba(255,255,0,1), 0 0 80px rgba(255,0,0,0.8);
                transform: scale(1.05);
            }
        }

        /* Notifications */
        .notifications {
            position: fixed;
            top: 100px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .notification {
            padding: 15px 25px;
            border-radius: 15px;
            color: white;
            font-weight: 700;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            animation: notificationSlide 0.5s ease-out;
            max-width: 350px;
            border: 2px solid;
        }

        @keyframes notificationSlide {
            from { 
                opacity: 0;
                transform: translateX(100%);
            }
            to { 
                opacity: 1;
                transform: translateX(0);
            }
        }

        .notification.success {
            background: rgba(0,255,0,0.2);
            border-color: #00ff00;
        }

        .notification.error {
            background: rgba(255,0,0,0.2);
            border-color: #ff0000;
        }

        .notification.warning {
            background: rgba(255,255,0,0.2);
            border-color: #ffff00;
            color: #000000;
        }

        .notification.info {
            background: rgba(0,100,255,0.2);
            border-color: #0066ff;
        }

        /* Special Effects */
        .special-effect {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 8rem;
            font-weight: 900;
            color: white;
            z-index: 999;
            pointer-events: none;
            text-shadow: 0 0 30px rgba(255,255,255,0.8);
        }

        .skip-effect {
            animation: skipEffect 1s ease-out forwards;
        }

        .reverse-effect {
            animation: reverseEffect 1s ease-out forwards;
        }

        .draw-effect {
            animation: drawEffect 1s ease-out forwards;
        }

        @keyframes skipEffect {
            0% { 
                opacity: 0;
                transform: translate(-50%, -50%) scale(0) rotate(0deg);
            }
            50% { 
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.2) rotate(180deg);
            }
            100% { 
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8) rotate(360deg);
            }
        }

        @keyframes reverseEffect {
            0% { 
                opacity: 0;
                transform: translate(-50%, -50%) scale(0) rotate(0deg);
            }
            50% { 
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.2) rotate(-180deg);
            }
            100% { 
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8) rotate(-360deg);
            }
        }

        @keyframes drawEffect {
            0% { 
                opacity: 0;
                transform: translate(-50%, -50%) scale(0);
                color: #ff0000;
            }
            50% { 
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.5);
                color: #ffff00;
            }
            100% { 
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
                color: #ff0000;
            }
        }

        /* Particles */
        .particle {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            pointer-events: none;
            animation: particleFall 3s linear forwards;
        }

        @keyframes particleFall {
            0% {
                opacity: 1;
                transform: translateY(0) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: translateY(200px) rotate(360deg);
            }
        }

        /* Bot Thinking */
        .bot-thinking {
            color: white;
            font-weight: 700;
            padding: 10px 20px;
            background: rgba(255,100,0,0.3);
            border-radius: 15px;
            margin-top: 10px;
            animation: thinkingPulse 1.5s ease-in-out infinite;
        }

        @keyframes thinkingPulse {
            0%, 100% { opacity: 0.7; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
        }

        /* Achievement */
        .achievement {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #ff6600, #ffff00);
            color: #000000;
            padding: 25px 40px;
            border-radius: 20px;
            font-weight: 800;
            text-align: center;
            z-index: 1001;
            box-shadow: 0 20px 60px rgba(255,102,0,0.5);
            border: 3px solid #ffffff;
            animation: achievementAppear 3s ease-out forwards;
        }

        @keyframes achievementAppear {
            0% { 
                opacity: 0;
                transform: translate(-50%, -50%) scale(0) rotate(180deg);
            }
            20% { 
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.2) rotate(0deg);
            }
            80% { 
                opacity: 1;
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
            }
            100% { 
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8) rotate(0deg);
            }
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .game-board {
                grid-template-columns: 1fr;
                gap: 30px;
            }

            .game-info {
                flex-wrap: wrap;
                gap: 20px;
            }

            .logo {
                font-size: 3.5rem;
            }
        }

        @media (max-width: 768px) {
            .level-options {
                grid-template-columns: 1fr;
            }

            .color-options {
                grid-template-columns: repeat(4, 1fr);
            }

            .color-option {
                width: 60px;
                height: 60px;
            }

            .game-header {
                flex-direction: column;
                gap: 20px;
            }

            .card {
                width: 70px;
                height: 105px;
            }

            .current-card {
                width: 110px;
                height: 165px;
            }

            .logo {
                font-size: 2.5rem;
            }
        }

        @media (max-width: 480px) {
            .player-cards {
                gap: 4px;
                padding: 15px;
            }

            .card {
                width: 60px;
                height: 90px;
                font-size: 1rem;
            }

            .card .main-symbol {
                font-size: 2rem;
            }

            .btn {
                padding: 12px 25px;
                font-size: 1rem;
            }

            .settings-screen, .level-selector {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-spinner"></div>
        <div class="loading-text">Memuat UNO Game...</div>
    </div>

    <div class="background-pattern"></div>
    <div class="uno-logo-bg">UNO</div>

    <!-- Game Timer -->
    <div class="game-timer" id="gameTimer" style="display: none;">
        ‚è±Ô∏è <span id="timerDisplay">00:00</span>
    </div>

    <div class="game-container">
        <!-- Menu Screen -->
        <div class="menu-screen" id="menuScreen">
            <h1 class="logo">UNO</h1>
            <div class="menu-buttons">
                <button class="btn btn-primary" onclick="showLevelSelector()">üéÆ MULAI PERMAINAN</button>
                <button class="btn btn-secondary" onclick="showSettings()">‚öôÔ∏è PENGATURAN</button>
                <button class="btn btn-info" onclick="showRules()">üìñ CARA BERMAIN</button>
                <button class="btn btn-info" onclick="showStats()">üìä STATISTIK</button>
            </div>
            
            <div class="level-selector" id="levelSelector" style="display: none;">
                <h3 class="level-title">üéØ PILIH LEVEL KESULITAN</h3>
                <div class="level-options">
                    <div class="level-option" onclick="selectLevel('easy')">
                        <div class="level-name">üåü MUDAH</div>
                        <div class="level-desc">Bot bermain santai, cocok untuk pemula. Memberikan kesempatan lebih untuk menang.</div>
                    </div>
                    <div class="level-option" onclick="selectLevel('medium')">
                        <div class="level-name">‚ö° SEDANG</div>
                        <div class="level-desc">Bot bermain strategis dan cukup cerdas. Tantangan yang seimbang.</div>
                    </div>
                    <div class="level-option" onclick="selectLevel('hard')">
                        <div class="level-name">üî• SULIT</div>
                        <div class="level-desc">Bot sangat pintar dan agresif. Hanya untuk pemain berpengalaman!</div>
                    </div>
                    <div class="level-option" onclick="selectLevel('expert')">
                        <div class="level-name">üíÄ EXPERT</div>
                        <div class="level-desc">Bot dengan AI terbaik. Siap untuk tantangan ultimate?</div>
                    </div>
                </div>
                <button class="btn btn-primary" style="margin-top: 30px;" onclick="startGame()">üöÄ MULAI PERMAINAN</button>
            </div>
        </div>

        <!-- Settings Screen -->
        <div class="settings-screen" id="settingsScreen">
            <h2 class="settings-title">‚öôÔ∏è PENGATURAN GAME</h2>
            <div class="settings-group">
                <label class="settings-label">üîä Volume Sound Effect</label>
                <input type="range" class="volume-control" id="sfxVolume" min="0" max="100" value="70">
                <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem; margin-top: 5px;">
                    Volume: <span id="sfxVolumeDisplay">70</span>%
                </div>
            </div>
            <div class="settings-group">
                <label class="settings-label">üéµ Volume Music Background</label>
                <input type="range" class="volume-control" id="musicVolume" min="0" max="100" value="50">
                <div style="color: rgba(255,255,255,0.7); font-size: 0.9rem; margin-top: 5px;">
                    Volume: <span id="musicVolumeDisplay">50</span>%
                </div>
            </div>
            <div class="settings-group">
                <label class="settings-label">üé® Tema Background</label>
                <select class="settings-control" id="themeSelect">
                    <option value="classic">Classic Red UNO</option>
                    <option value="ocean">Ocean Blue</option>
                    <option value="forest">Forest Green</option>
                    <option value="sunset">Sunset Orange</option>
                    <option value="galaxy">Galaxy Purple</option>
                </select>
            </div>
            <div class="settings-group">
                <label class="settings-label">üéØ Animasi Kartu</label>
                <select class="settings-control" id="animationSelect">
                    <option value="full">Full Animation</option>
                    <option value="reduced">Reduced Animation</option>
                    <option value="minimal">Minimal Animation</option>
                </select>
            </div>
            <div class="settings-group">
                <label class="settings-label">üéÆ Kontrol Game</label>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                    <label style="display: flex; align-items: center; color: white;">
                        <input type="checkbox" id="autoUnoCall" style="margin-right: 10px; transform: scale(1.2);">
                        Auto UNO Call
                    </label>
                    <label style="display: flex; align-items: center; color: white;">
                        <input type="checkbox" id="showHints" checked style="margin-right: 10px; transform: scale(1.2);">
                        Tampilkan Hints
                    </label>
                    <label style="display: flex; align-items: center; color: white;">
                        <input type="checkbox" id="fastMode" style="margin-right: 10px; transform: scale(1.2);">
                        Fast Mode
                    </label>
                    <label style="display: flex; align-items: center; color: white;">
                        <input type="checkbox" id="soundEffects" checked style="margin-right: 10px; transform: scale(1.2);">
                        Sound Effects
                    </label>
                </div>
            </div>
            <button class="btn btn-secondary" onclick="backToMenu()" style="margin-top: 40px;">üîô KEMBALI KE MENU</button>
        </div>

        <!-- Game Screen -->
        <div class="game-screen" id="gameScreen">
            <div class="game-header">
                <div class="game-info">
                    <div class="info-item">
                        <div class="info-label">Level</div>
                        <div class="info-value" id="currentLevel">MUDAH</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Skor</div>
                        <div class="info-value" id="playerScore">0</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Giliran</div>
                        <div class="info-value" id="currentTurn">ANDA</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Sisa Deck</div>
                        <div class="info-value" id="deckCount">80</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Round</div>
                        <div class="info-value" id="roundNumber">1</div>
                    </div>
                </div>
                <div style="display: flex; gap: 15px;">
                    <button class="btn btn-info" onclick="showGameStats()" style="padding: 10px 20px; font-size: 1rem;">üìä STATS</button>
                    <button class="btn btn-secondary" onclick="pauseGame()">‚è∏Ô∏è PAUSE</button>
                </div>
            </div>

            <div class="game-board">
                <!-- Opponent Area -->
                <div class="opponent-area">
                    <h3 class="opponent-label">ü§ñ BOT PLAYER (Kartu: <span id="botCardCount">7</span>)</h3>
                    <div class="opponent-cards" id="opponentCards" style="position: relative;"></div>
                </div>

                <!-- Center Area -->
                <div class="center-area">
                    <div class="current-card card-red" id="currentCard">
                        <div class="card-corners top-left">7</div>
                        <div class="main-symbol">7</div>
                        <div class="card-corners bottom-right">7</div>
                    </div>
                    <div class="draw-pile" onclick="drawCard()" id="drawPile"></div>
                    <div style="color: white; text-align: center; margin-top: 10px; font-weight: 600;">
                        Warna Aktif: <span id="currentColorDisplay" style="font-weight: 900;">Merah</span>
                    </div>
                </div>

                <!-- Player Area -->
                <div class="player-area">
                    <h3 class="player-label">üë§ ANDA (Kartu: <span id="playerCardCount">7</span>)</h3>
                    <div class="player-cards" id="playerCards"></div>
                    <div class="action-buttons">
                        <button class="btn-uno game-btn" onclick="callUno()" id="unoBtn" style="display: none;">üéØ UNO!</button>
                        <button class="btn-pass game-btn" onclick="passTurn()" id="passBtn">‚è≠Ô∏è LEWATI GILIRAN</button>
                        <button class="btn btn-info game-btn" onclick="showCardCount()" style="background: linear-gradient(135deg, #3742fa, #2f3542);">üìã KARTU</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Color Selector -->
        <div class="color-selector" id="colorSelector">
            <h3>üåà Pilih Warna untuk Kartu Wild:</h3>
            <div class="color-options">
                <div class="color-option red" onclick="selectWildColor('red')"></div>
                <div class="color-option blue" onclick="selectWildColor('blue')"></div>
                <div class="color-option green" onclick="selectWildColor('green')"></div>
                <div class="color-option yellow" onclick="selectWildColor('yellow')"></div>
            </div>
        </div>

        <!-- Win Screen -->
        <div class="win-screen" id="winScreen">
            <div class="win-content">
                <div class="win-title" id="winTitle">üéâ MENANG!</div>
                <div id="winMessage" style="font-size: 1.4rem; margin-bottom: 40px; font-weight: 700;">Selamat! Anda memenangkan permainan UNO!</div>
                <div style="margin-bottom: 40px; font-size: 1.2rem;">
                    <div style="margin-bottom: 10px;">üèÜ Skor Akhir: <span id="finalScore" style="font-weight: 900; color: #ffff00;">0</span></div>
                    <div style="margin-bottom: 10px;">üéØ Level: <span id="finalLevel" style="font-weight: 900; color: #ffff00;">MUDAH</span></div>
                    <div style="margin-bottom: 10px;">‚è±Ô∏è Waktu: <span id="gameTime" style="font-weight: 900; color: #ffff00;">0:00</span></div>
                    <div>üé™ Round: <span id="finalRound" style="font-weight: 900; color: #ffff00;">1</span></div>
                </div>
                <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="playAgain()">üîÑ MAIN LAGI</button>
                    <button class="btn btn-secondary" onclick="nextRound()" id="nextRoundBtn">‚ñ∂Ô∏è ROUND BERIKUTNYA</button>
                    <button class="btn btn-info" onclick="backToMenu()">üè† MENU UTAMA</button>
                </div>
            </div>
        </div>

        <!-- Statistics Screen -->
        <div class="settings-screen" id="statsScreen" style="display: none;">
            <h2 class="settings-title">üìä STATISTIK PERMAINAN</h2>
            <div class="settings-group">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div style="text-align: center; color: white;">
                        <div style="font-size: 2rem; font-weight: 900; color: #00ff00;" id="totalWins">0</div>
                        <div style="opacity: 0.8;">Total Kemenangan</div>
                    </div>
                    <div style="text-align: center; color: white;">
                        <div style="font-size: 2rem; font-weight: 900; color: #ffff00;" id="totalGames">0</div>
                        <div style="opacity: 0.8;">Total Permainan</div>
                    </div>
                    <div style="text-align: center; color: white;">
                        <div style="font-size: 2rem; font-weight: 900; color: #00ffff;" id="winRate">0%</div>
                        <div style="opacity: 0.8;">Win Rate</div>
                    </div>
                    <div style="text-align: center; color: white;">
                        <div style="font-size: 2rem; font-weight: 900; color: #ff6600;" id="highScore">0</div>
                        <div style="opacity: 0.8;">Skor Tertinggi</div>
                    </div>
                    <div style="text-align: center; color: white;">
                        <div style="font-size: 2rem; font-weight: 900; color: #ff00ff;" id="fastestWin">--:--</div>
                        <div style="opacity: 0.8;">Kemenangan Tercepat</div>
                    </div>
                </div>
            </div>
            <div class="settings-group">
                <label class="settings-label">üèÜ Prestasi Terbuka</label>
                <div id="achievementsList" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 15px;">
                    <!-- Achievement items will be populated by JavaScript -->
                </div>
            </div>
            <div style="display: flex; gap: 20px; justify-content: center; margin-top: 40px;">
                <button class="btn btn-secondary" onclick="resetStats()">üóëÔ∏è RESET STATISTIK</button>
                <button class="btn btn-primary" onclick="backToMenu()">üîô KEMBALI</button>
            </div>
        </div>

        <!-- Notifications -->
        <div class="notifications" id="notifications"></div>

        <!-- Special Effects Container -->
        <div class="special-effect" id="specialEffect"></div>
    </div>

    <script>
        class EnhancedUnoGame {
            constructor() {
                this.colors = ['red', 'blue', 'green', 'yellow'];
                this.numbers = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];
                this.actions = ['skip', 'reverse', 'draw2'];
                this.wilds = ['wild', 'wild4'];
                
                this.deck = [];
                this.playerCards = [];
                this.botCards = [];
                this.currentCard = null;
                this.currentColor = null;
                this.isPlayerTurn = true;
                this.level = 'easy';
                this.score = 0;
                this.round = 1;
                this.gameActive = false;
                this.unoCalledByPlayer = false;
                this.unoCalledByBot = false;
                this.gameStartTime = Date.now();
                this.gameTimer = null;
                this.botThinkingTimeout = null;
                
                // Enhanced features
                this.stats = this.loadStats();
                this.achievements = this.loadAchievements();
                this.settings = this.loadSettings();
                this.consecutiveWins = 0;
                this.cardsPlayed = 0;
                this.specialCardsPlayed = 0;
                
                this.soundEffects = {
                    cardPlay: this.createSound(440, 0.1, 'sine'),
                    cardDraw: this.createSound(330, 0.1, 'triangle'),
                    uno: this.createSound(523, 0.3, 'square'),
                    win: this.createSound(659, 0.5, 'sine'),
                    lose: this.createSound(220, 0.5, 'sawtooth'),
                    skip: this.createSound(392, 0.2, 'sawtooth'),
                    reverse: this.createSound(349, 0.2, 'triangle'),
                    wild: this.createSound(293, 0.3, 'square'),
                    shuffle: this.createSound(200, 0.2, 'sawtooth'),
                    achievement: this.createSound(880, 0.4, 'sine'),
                    levelUp: this.createSound(740, 0.6, 'square')
                };
                
                this.initializeGame();
                this.startGameTimer();
            }

            loadStats() {
                const defaultStats = {
                    totalWins: 0,
                    totalLosses: 0,
                    totalGames: 0,
                    highScore: 0,
                    fastestWin: null,
                    gamesPerLevel: { easy: 0, medium: 0, hard: 0, expert: 0 },
                    winsPerLevel: { easy: 0, medium: 0, hard: 0, expert: 0 }
                };
                const saved = localStorage.getItem('unoGameStats');
                return saved ? JSON.parse(saved) : defaultStats;
            }

            saveStats() {
                localStorage.setItem('unoGameStats', JSON.stringify(this.stats));
            }

            loadAchievements() {
                const defaultAchievements = {
                    firstWin: false,
                    winStreak3: false,
                    winStreak5: false,
                    speedWin: false,
                    expertWin: false,
                    unoMaster: false,
                    cardCounter: false,
                    wildMaster: false,
                    perfectGame: false,
                    comebackKing: false
                };
                const saved = localStorage.getItem('unoGameAchievements');
                return saved ? JSON.parse(saved) : defaultAchievements;
            }

            saveAchievements() {
                localStorage.setItem('unoGameAchievements', JSON.stringify(this.achievements));
            }

            loadSettings() {
                const defaultSettings = {
                    sfxVolume: 70,
                    musicVolume: 50,
                    theme: 'classic',
                    animation: 'full',
                    autoUnoCall: false,
                    showHints: true,
                    fastMode: false,
                    soundEffects: true
                };
                const saved = localStorage.getItem('unoGameSettings');
                return saved ? JSON.parse(saved) : defaultSettings;
            }

            saveSettings() {
                localStorage.setItem('unoGameSettings', JSON.stringify(this.settings));
            }

            createSound(frequency, duration, type = 'sine') {
                return () => {
                    if (!this.settings.soundEffects) return;
                    
                    try {
                        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        oscillator.frequency.value = frequency;
                        oscillator.type = type;
                        
                        const volume = this.settings.sfxVolume / 100;
                        gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                        gainNode.gain.linearRampToValueAtTime(volume * 0.1, audioContext.currentTime + 0.01);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
                        
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + duration);
                    } catch (e) {
                        console.log('Audio not supported');
                    }
                };
            }

            initializeGame() {
                this.createDeck();
                this.shuffleDeck();
                this.dealCards();
                this.setFirstCard();
                this.updateUI();
                this.gameStartTime = Date.now();
                this.cardsPlayed = 0;
                this.specialCardsPlayed = 0;
            }

            startGameTimer() {
                this.gameTimer = setInterval(() => {
                    if (this.gameActive) {
                        const elapsed = Math.floor((Date.now() - this.gameStartTime) / 1000);
                        const minutes = Math.floor(elapsed / 60);
                        const seconds = elapsed % 60;
                        const timeStr = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                        document.getElementById('timerDisplay').textContent = timeStr;
                    }
                }, 1000);
            }

            createDeck() {
                this.deck = [];
                
                // Number cards
                this.colors.forEach(color => {
                    this.deck.push({ color, value: 0, type: 'number' });
                    for (let i = 1; i <= 9; i++) {
                        this.deck.push({ color, value: i, type: 'number' });
                        this.deck.push({ color, value: i, type: 'number' });
                    }
                });

                // Action cards
                this.colors.forEach(color => {
                    this.actions.forEach(action => {
                        this.deck.push({ color, value: action, type: 'action' });
                        this.deck.push({ color, value: action, type: 'action' });
                    });
                });

                // Wild cards
                for (let i = 0; i < 4; i++) {
                    this.deck.push({ color: 'wild', value: 'wild', type: 'wild' });
                    this.deck.push({ color: 'wild', value: 'wild4', type: 'wild' });
                }
            }

            shuffleDeck() {
                this.soundEffects.shuffle();
                for (let i = this.deck.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [this.deck[i], this.deck[j]] = [this.deck[j], this.deck[i]];
                }
            }

            dealCards() {
                this.playerCards = [];
                this.botCards = [];
                
                for (let i = 0; i < 7; i++) {
                    this.playerCards.push(this.deck.pop());
                    this.botCards.push(this.deck.pop());
                }
            }

            setFirstCard() {
                do {
                    this.currentCard = this.deck.pop();
                } while (this.currentCard.type === 'wild');
                
                this.currentColor = this.currentCard.color;
                
                if (this.currentCard.value === 'skip') {
                    this.isPlayerTurn = false;
                    this.showNotification('üîÑ Bot dilewati! Giliran Anda lagi.', 'success');
                } else if (this.currentCard.value === 'draw2') {
                    this.drawCards(2, 'player');
                    this.isPlayerTurn = false;
                    this.showNotification('üì• Anda mengambil 2 kartu! Giliran Bot.', 'warning');
                }
            }

            drawCards(count, player) {
                const cards = player === 'player' ? this.playerCards : this.botCards;
                
                for (let i = 0; i < count; i++) {
                    if (this.deck.length === 0) {
                        this.reshuffleDeck();
                    }
                    cards.push(this.deck.pop());
                    this.createParticleEffect(player === 'player' ? 'player' : 'bot');
                }
                
                this.soundEffects.cardDraw();
            }

            reshuffleDeck() {
                this.showNotification('üîÑ Deck dikocok ulang!', 'info');
                const tempCard = this.currentCard;
                this.deck = [];
                this.createDeck();
                this.shuffleDeck();
                this.currentCard = tempCard;
            }

            canPlayCard(card) {
                return card.color === 'wild' || 
                       card.color === this.currentColor || 
                       card.value === this.currentCard.value;
            }

            playCard(cardIndex, player = 'player') {
                const cards = player === 'player' ? this.playerCards : this.botCards;
                const card = cards[cardIndex];
                
                if (!this.canPlayCard(card) && player === 'player') {
                    this.showNotification('‚ùå Kartu tidak dapat dimainkan!', 'error');
                    return false;
                }

                // Add playing animation
                if (player === 'player') {
                    const cardElement = document.querySelectorAll('.card')[cardIndex];
                    if (cardElement) {
                        cardElement.classList.add('playing');
                        setTimeout(() => cardElement.classList.remove('playing'), 800);
                    }
                }

                cards.splice(cardIndex, 1);
                this.currentCard = card;
                this.cardsPlayed++;
                
                if (card.type === 'action' || card.type === 'wild') {
                    this.specialCardsPlayed++;
                }
                
                if (card.type !== 'wild') {
                    this.currentColor = card.color;
                }

                this.soundEffects.cardPlay();
                this.handleSpecialCard(card, player);
                
                // Check for UNO
                if (cards.length === 1) {
                    if (player === 'player') {
                        if (this.settings.autoUnoCall || this.unoCalledByPlayer) {
                            this.showNotification('üéØ UNO dipanggil otomatis!', 'success');
                            this.soundEffects.uno();
                        } else {
                            this.showNotification('üö® Anda lupa memanggil UNO! Mengambil 2 kartu.', 'error');
                            this.drawCards(2, 'player');
                        }
                    } else {
                        this.unoCalledByBot = true;
                        this.showNotification('ü§ñ Bot memanggil UNO!', 'warning');
                        this.soundEffects.uno();
                    }
                }
                
                // Check for win
                if (cards.length === 0) {
                    this.endGame(player);
                    return true;
                }
                
                this.updateUI();
                return true;
            }

            handleSpecialCard(card, player) {
                switch (card.value) {
                    case 'skip':
                        this.soundEffects.skip();
                        this.showSpecialEffect('‚è≠Ô∏è', 'skip-effect');
                        this.showNotification(player === 'player' ? '‚è≠Ô∏è Bot dilewati!' : '‚è≠Ô∏è Anda dilewati!', 'info');
                        break;
                        
                    case 'reverse':
                        this.soundEffects.reverse();
                        this.showSpecialEffect('üîÑ', 'reverse-effect');
                        this.showNotification('üîÑ Arah permainan dibalik!', 'info');
                        break;
                        
                    case 'draw2':
                        const opponent = player === 'player' ? 'bot' : 'player';
                        this.drawCards(2, opponent);
                        this.showSpecialEffect('+2', 'draw-effect');
                        this.showNotification(player === 'player' ? 'üì• Bot mengambil 2 kartu!' : 'üì• Anda mengambil 2 kartu!', 'warning');
                        break;
                        
                    case 'wild':
                        this.soundEffects.wild();
                        if (player === 'player') {
                            this.showColorSelector();
                            return;
                        } else {
                            this.currentColor = this.getBotColorChoice();
                            this.showNotification(`üåà Bot memilih warna ${this.getColorName(this.currentColor)}`, 'info');
                        }
                        break;
                        
                    case 'wild4':
                        this.soundEffects.wild();
                        const target = player === 'player' ? 'bot' : 'player';
                        this.drawCards(4, target);
                        this.showSpecialEffect('+4', 'draw-effect');
                        this.showNotification(player === 'player' ? 'üì• Bot mengambil 4 kartu!' : 'üì• Anda mengambil 4 kartu!', 'warning');
                        
                        if (player === 'player') {
                            this.showColorSelector();
                            return;
                        } else {
                            this.currentColor = this.getBotColorChoice();
                            this.showNotification(`üåà Bot memilih warna ${this.getColorName(this.currentColor)}`, 'info');
                        }
                        break;
                        
                    default:
                        this.isPlayerTurn = !this.isPlayerTurn;
                        return;
                }
                
                this.isPlayerTurn = !this.isPlayerTurn;
            }

            getBotColorChoice() {
                // Smart color selection based on bot's cards
                const colorCounts = { red: 0, blue: 0, green: 0, yellow: 0 };
                
                this.botCards.forEach(card => {
                    if (card.color !== 'wild') {
                        colorCounts[card.color]++;
                    }
                });
                
                // Choose color with most cards
                return Object.keys(colorCounts).reduce((a, b) => 
                    colorCounts[a] > colorCounts[b] ? a : b
                );
            }

            showSpecialEffect(symbol, className) {
                const effectEl = document.getElementById('specialEffect');
                effectEl.textContent = symbol;
                effectEl.className = `special-effect ${className}`;
                
                setTimeout(() => {
                    effectEl.className = 'special-effect';
                    effectEl.textContent = '';
                }, 1000);
            }

            createParticleEffect(area) {
                const container = area === 'player' ? 
                    document.getElementById('playerCards') : 
                    document.getElementById('opponentCards');
                
                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        const particle = document.createElement('div');
                        particle.className = 'particle';
                        particle.style.left = Math.random() * 100 + '%';
                        particle.style.backgroundColor = ['#ff0000', '#00ff00', '#0000ff', '#ffff00'][Math.floor(Math.random() * 4)];
                        container.appendChild(particle);
                        
                        setTimeout(() => particle.remove(), 3000);
                    }, i * 100);
                }
            }

            getColorName(color) {
                const names = {
                    'red': 'Merah',
                    'blue': 'Biru', 
                    'green': 'Hijau',
                    'yellow': 'Kuning'
                };
                return names[color] || color;
            }

            showColorSelector() {
                document.getElementById('colorSelector').style.display = 'block';
            }

            selectWildColor(color) {
                this.currentColor = color;
                document.getElementById('colorSelector').style.display = 'none';
                this.showNotification(`üåà Anda memilih warna ${this.getColorName(color)}`, 'success');
                this.isPlayerTurn = !this.isPlayerTurn;
                this.updateUI();
                
                if (!this.isPlayerTurn) {
                    setTimeout(() => this.botTurn(), this.settings.fastMode ? 500 : 1500);
                }
            }

            botTurn() {
                if (!this.gameActive || this.isPlayerTurn) return;
                
                // Show bot thinking indicator
                this.showBotThinking();
                
                const playableCards = this.botCards.map((card, index) => ({ card, index }))
                    .filter(item => this.canPlayCard(item.card));
                
                const thinkTime = this.settings.fastMode ? 500 : (1000 + Math.random() * 1500);
                
                setTimeout(() => {
                    this.hideBotThinking();
                    
                    if (playableCards.length > 0) {
                        let chosenCard = this.getBotChoice(playableCards);
                        this.playCard(chosenCard.index, 'bot');
                    } else {
                        this.drawCards(1, 'bot');
                        this.showNotification('ü§ñ Bot mengambil kartu', 'info');
                        this.isPlayerTurn = true;
                        this.updateUI();
                    }
                }, thinkTime);
            }

            getBotChoice(playableCards) {
                switch (this.level) {
                    case 'easy':
                        return playableCards[Math.floor(Math.random() * playableCards.length)];
                        
                    case 'medium':
                        const actionCards = playableCards.filter(item => 
                            item.card.type === 'action' || item.card.type === 'wild');
                        return actionCards.length > 0 && Math.random() < 0.6 ? 
                            actionCards[Math.floor(Math.random() * actionCards.length)] :
                            playableCards[Math.floor(Math.random() * playableCards.length)];
                            
                    case 'hard':
                        return this.getStrategicChoice(playableCards);
                        
                    case 'expert':
                        return this.getExpertChoice(playableCards);
                        
                    default:
                        return playableCards[0];
                }
            }

            getStrategicChoice(playableCards) {
                const wilds = playableCards.filter(item => item.card.type === 'wild');
                const actions = playableCards.filter(item => item.card.type === 'action');
                const numbers = playableCards.filter(item => item.card.type === 'number');
                
                if (wilds.length > 0 && this.botCards.length > 3) {
                    return wilds[0];
                } else if (actions.length > 0) {
                    return actions[0];
                } else if (numbers.length > 0) {
                    return numbers.reduce((best, current) => 
                        current.card.value > best.card.value ? current : best);
                } else {
                    return playableCards[0];
                }
            }

            getExpertChoice(playableCards) {
                // Advanced AI logic
                const playerCardCount = this.playerCards.length;
                
                // If player has few cards, prioritize attack cards
                if (playerCardCount <= 3) {
                    const attackCards = playableCards.filter(item => 
                        item.card.value === 'draw2' || item.card.value === 'wild4' || item.card.value === 'skip');
                    if (attackCards.length > 0) {
                        return attackCards[0];
                    }
                }
                
                // Color analysis
                const colorCounts = { red: 0, blue: 0, green: 0, yellow: 0 };
                this.botCards.forEach(card => {
                    if (card.color !== 'wild') colorCounts[card.color]++;
                });
                
                const dominantColor = Object.keys(colorCounts).reduce((a, b) => 
                    colorCounts[a] > colorCounts[b] ? a : b
                );
                
                // Prefer cards of dominant color
                const colorMatches = playableCards.filter(item => item.card.color === dominantColor);
                if (colorMatches.length > 0) {
                    return colorMatches[0];
                }
                
                return this.getStrategicChoice(playableCards);
            }

            showBotThinking() {
                const opponentArea = document.querySelector('.opponent-area');
                const thinking = document.createElement('div');
                thinking.className = 'bot-thinking';
                thinking.textContent = 'ü§î Bot sedang berpikir...';
                thinking.id = 'botThinking';
                opponentArea.appendChild(thinking);
            }

            hideBotThinking() {
                const thinking = document.getElementById('botThinking');
                if (thinking) thinking.remove();
            }

            playerPlayCard(cardIndex) {
                if (!this.gameActive || !this.isPlayerTurn) return;
                
                if (this.playCard(cardIndex, 'player')) {
                    this.unoCalledByPlayer = false;
                    
                    if (!this.isPlayerTurn && this.gameActive) {
                        setTimeout(() => this.botTurn(), this.settings.fastMode ? 500 : 1000);
                    }
                }
            }

            drawCard() {
                if (!this.gameActive || !this.isPlayerTurn) return;
                
                this.drawCards(1, 'player');
                this.showNotification('üì• Anda mengambil kartu dari deck', 'info');
                this.isPlayerTurn = false;
                this.updateUI();
                
                setTimeout(() => this.botTurn(), this.settings.fastMode ? 500 : 1000);
            }

            callUno() {
                if (this.playerCards.length === 2) {
                    this.unoCalledByPlayer = true;
                    this.soundEffects.uno();
                    this.showNotification('üéØ UNO DIPANGGIL!', 'success');
                    document.getElementById('unoBtn').style.display = 'none';
                }
            }

            passTurn() {
                if (!this.gameActive || !this.isPlayerTurn) return;
                
                this.isPlayerTurn = false;
                this.showNotification('‚è≠Ô∏è Anda melewati giliran', 'info');
                this.updateUI();
                
                setTimeout(() => this.botTurn(), this.settings.fastMode ? 500 : 1000);
            }

            updateUI() {
                this.updateCurrentCard();
                this.updatePlayerCards();
                this.updateBotCards();
                this.updateGameInfo();
                this.updateActionButtons();
            }

            updateCurrentCard() {
                const currentCardEl = document.getElementById('currentCard');
                const card = this.currentCard;
                
                currentCardEl.className = `current-card card-${this.currentColor}`;
                
                let symbol = '';
                let corners = '';
                
                if (card.type === 'number') {
                    symbol = card.value;
                    corners = card.value;
                } else if (card.type === 'action') {
                    switch (card.value) {
                        case 'skip':
                            symbol = '‚è≠Ô∏è';
                            corners = '‚è≠Ô∏è';
                            break;
                        case 'reverse':
                            symbol = 'üîÑ';
                            corners = 'üîÑ';
                            break;
                        case 'draw2':
                            symbol = '+2';
                            corners = '+2';
                            break;
                    }
                } else if (card.type === 'wild') {
                    symbol = card.value === 'wild4' ? '+4' : 'üåà';
                    corners = card.value === 'wild4' ? '+4' : 'üåà';
                    currentCardEl.className = `current-card card-${this.currentColor}`;
                }
                
                currentCardEl.innerHTML = `
                    <div class="card-corners top-left">${corners}</div>
                    <div class="main-symbol">${symbol}</div>
                    <div class="card-corners bottom-right">${corners}</div>
                `;

                // Update color display
                document.getElementById('currentColorDisplay').textContent = this.getColorName(this.currentColor);
                document.getElementById('currentColorDisplay').style.color = this.getColorHex(this.currentColor);
            }

            getColorHex(color) {
                const colors = {
                    'red': '#ff0000',
                    'blue': '#0066ff',
                    'green': '#00cc00',
                    'yellow': '#ffcc00'
                };
                return colors[color] || '#ffffff';
            }

            updatePlayerCards() {
                const container = document.getElementById('playerCards');
                container.innerHTML = '';
                
                this.playerCards.forEach((card, index) => {
                    const cardEl = document.createElement('div');
                    cardEl.className = `card card-${card.color}`;
                    
                    if (this.canPlayCard(card) && this.isPlayerTurn) {
                        cardEl.classList.add('playable');
                    }
                    
                    let symbol = '';
                    let corners = '';
                    
                    if (card.type === 'number') {
                        symbol = card.value;
                        corners = card.value;
                    } else if (card.type === 'action') {
                        switch (card.value) {
                            case 'skip': 
                                symbol = '‚è≠Ô∏è'; 
                                corners = '‚è≠Ô∏è';
                                break;
                            case 'reverse': 
                                symbol = 'üîÑ'; 
                                corners = 'üîÑ';
                                break;
                            case 'draw2': 
                                symbol = '+2'; 
                                corners = '+2';
                                break;
                        }
                    } else if (card.type === 'wild') {
                        symbol = card.value === 'wild4' ? '+4' : 'üåà';
                        corners = card.value === 'wild4' ? '+4' : 'üåà';
                    }
                    
                    cardEl.innerHTML = `
                        <div class="card-corners top-left">${corners}</div>
                        <div class="main-symbol">${symbol}</div>
                        <div class="card-corners bottom-right">${corners}</div>
                    `;
                    
                    cardEl.onclick = () => this.playerPlayCard(index);
                    
                    // Add tooltip for hints
                    if (this.settings.showHints && this.canPlayCard(card) && this.isPlayerTurn) {
                        cardEl.title = `Klik untuk memainkan kartu ${this.getCardName(card)}`;
                    }
                    
                    container.appendChild(cardEl);
                });
                
                document.getElementById('playerCardCount').textContent = this.playerCards.length;
            }

            getCardName(card) {
                if (card.type === 'number') {
                    return `${card.value} ${this.getColorName(card.color)}`;
                } else if (card.type === 'action') {
                    const actionNames = {
                        'skip': 'Skip',
                        'reverse': 'Reverse',
                        'draw2': 'Draw 2'
                    };
                    return `${actionNames[card.value]} ${this.getColorName(card.color)}`;
                } else {
                    return card.value === 'wild4' ? 'Wild Draw 4' : 'Wild';
                }
            }

            updateBotCards() {
                const container = document.getElementById('opponentCards');
                container.innerHTML = '';
                
                for (let i = 0; i < this.botCards.length; i++) {
                    const cardEl = document.createElement('div');
                    cardEl.className = 'card-back';
                    container.appendChild(cardEl);
                }
                
                document.getElementById('botCardCount').textContent = this.botCards.length;
            }

            updateGameInfo() {
                const turnEl = document.getElementById('currentTurn');
                turnEl.textContent = this.isPlayerTurn ? 'ANDA' : 'BOT';
                turnEl.style.color = this.isPlayerTurn ? '#00ff00' : '#ff6600';
                
                // Add highlight animation when turn changes
                turnEl.classList.add('highlight');
                setTimeout(() => turnEl.classList.remove('highlight'), 1000);
                
                document.getElementById('playerScore').textContent = this.score;
                document.getElementById('deckCount').textContent = this.deck.length;
                document.getElementById('roundNumber').textContent = this.round;
                
                const unoBtn = document.getElementById('unoBtn');
                if (this.playerCards.length === 2 && !this.unoCalledByPlayer && this.isPlayerTurn && !this.settings.autoUnoCall) {
                    unoBtn.style.display = 'inline-block';
                } else {
                    unoBtn.style.display = 'none';
                }
            }

            updateActionButtons() {
                const actionButtons = document.querySelectorAll('.action-buttons .game-btn');
                actionButtons.forEach(btn => {
                    if (btn.id !== 'unoBtn') {
                        btn.disabled = !this.isPlayerTurn || !this.gameActive;
                        btn.style.opacity = btn.disabled ? '0.5' : '1';
                    }
                });
            }

            showNotification(message, type = 'info') {
                const container = document.getElementById('notifications');
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.textContent = message;
                
                container.appendChild(notification);
                
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 4000);
            }

            getGameTime() {
                const elapsed = Math.floor((Date.now() - this.gameStartTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                return `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }

            checkAchievements(winner) {
                const gameTime = Math.floor((Date.now() - this.gameStartTime) / 1000);
                
                if (winner === 'player') {
                    // First win
                    if (!this.achievements.firstWin && this.stats.totalWins === 0) {
                        this.unlockAchievement('firstWin', 'üéâ Kemenangan Pertama!', 'Selamat atas kemenangan pertama Anda!');
                    }
                    
                    // Speed win (under 2 minutes)
                    if (!this.achievements.speedWin && gameTime < 120) {
                        this.unlockAchievement('speedWin', '‚ö° Kemenangan Kilat!', 'Menang dalam waktu kurang dari 2 menit!');
                    }
                    
                    // Expert win
                    if (!this.achievements.expertWin && this.level === 'expert') {
                        this.unlockAchievement('expertWin', 'üèÜ Master Expert!', 'Mengalahkan bot di level Expert!');
                    }
                    
                    // Win streak achievements
                    this.consecutiveWins++;
                    if (!this.achievements.winStreak3 && this.consecutiveWins >= 3) {
                        this.unlockAchievement('winStreak3', 'üî• Hat Trick!', '3 kemenangan berturut-turut!');
                    }
                    if (!this.achievements.winStreak5 && this.consecutiveWins >= 5) {
                        this.unlockAchievement('winStreak5', 'üåü Unstoppable!', '5 kemenangan berturut-turut!');
                    }
                    
                    // Perfect game (win without drawing extra cards)
                    if (!this.achievements.perfectGame && this.playerCards.length === 0 && this.cardsPlayed <= 7) {
                        this.unlockAchievement('perfectGame', 'üíé Permainan Sempurna!', 'Menang tanpa mengambil kartu tambahan!');
                    }
                    
                    // Wild master (used many special cards)
                    if (!this.achievements.wildMaster && this.specialCardsPlayed >= 5) {
                        this.unlockAchievement('wildMaster', 'üåà Wild Master!', 'Menggunakan 5+ kartu spesial dalam satu game!');
                    }
                } else {
                    this.consecutiveWins = 0;
                }
                
                // UNO Master (call UNO correctly 10 times)
                if (!this.achievements.unoMaster && this.unoCalledByPlayer) {
                    let unoCalls = parseInt(localStorage.getItem('unoCallCount') || '0') + 1;
                    localStorage.setItem('unoCallCount', unoCalls.toString());
                    if (unoCalls >= 10) {
                        this.unlockAchievement('unoMaster', 'üéØ UNO Master!', 'Memanggil UNO dengan benar 10 kali!');
                    }
                }
                
                // Card Counter (play 100 games)
                if (!this.achievements.cardCounter && this.stats.totalGames + 1 >= 100) {
                    this.unlockAchievement('cardCounter', 'üìä Card Counter!', 'Bermain 100 permainan!');
                }
            }

            unlockAchievement(key, title, description) {
                this.achievements[key] = true;
                this.saveAchievements();
                this.soundEffects.achievement();
                
                const achievement = document.createElement('div');
                achievement.className = 'achievement';
                achievement.innerHTML = `
                    <div style="font-size: 1.2rem; margin-bottom: 5px;">${title}</div>
                    <div style="font-size: 0.9rem; opacity: 0.8;">${description}</div>
                `;
                document.body.appendChild(achievement);
                
                setTimeout(() => achievement.remove(), 3000);
            }

            endGame(winner) {
                this.gameActive = false;
                
                if (this.gameTimer) {
                    clearInterval(this.gameTimer);
                }
                
                // Update statistics
                this.stats.totalGames++;
                if (winner === 'player') {
                    this.stats.totalWins++;
                    this.stats.winsPerLevel[this.level]++;
                    this.soundEffects.win();
                } else {
                    this.stats.totalLosses++;
                    this.soundEffects.lose();
                }
                this.stats.gamesPerLevel[this.level]++;
                
                // Calculate points
                const winnerCards = winner === 'player' ? this.playerCards : this.botCards;
                const loserCards = winner === 'player' ? this.botCards : this.playerCards;
                
                let points = 0;
                loserCards.forEach(card => {
                    if (card.type === 'number') {
                        points += card.value;
                    } else if (card.type === 'action') {
                        points += 20;
                    } else if (card.type === 'wild') {
                        points += 50;
                    }
                });
                
                if (winner === 'player') {
                    this.score += points;
                    
                    // Bonus points based on difficulty
                    const bonuses = { easy: 0, medium: 50, hard: 100, expert: 200 };
                    this.score += bonuses[this.level] || 0;
                    
                    // Update high score
                    if (this.score > this.stats.highScore) {
                        this.stats.highScore = this.score;
                    }
                    
                    // Update fastest win
                    const gameTime = this.getGameTime();
                    if (!this.stats.fastestWin || gameTime < this.stats.fastestWin) {
                        this.stats.fastestWin = gameTime;
                    }
                }
                
                this.checkAchievements(winner);
                this.saveStats();
                
                // Show win screen
                document.getElementById('winTitle').textContent = winner === 'player' ? 'üéâ KEMENANGAN!' : 'üò¢ KEKALAHAN!';
                document.getElementById('winMessage').textContent = 
                    winner === 'player' ? 
                    'Luar biasa! Anda berhasil mengalahkan bot!' : 
                    'Jangan menyerah! Bot berhasil menang kali ini.';
                document.getElementById('finalScore').textContent = this.score;
                document.getElementById('finalLevel').textContent = this.level.toUpperCase();
                document.getElementById('gameTime').textContent = this.getGameTime();
                document.getElementById('finalRound').textContent = this.round;
                
                // Show/hide next round button
                const nextRoundBtn = document.getElementById('nextRoundBtn');
                if (winner === 'player' && this.round < 10) {
                    nextRoundBtn.style.display = 'inline-block';
                } else {
                    nextRoundBtn.style.display = 'none';
                }
                
                document.getElementById('winScreen').style.display = 'flex';
            }
        }

        // Game instance
        let game = null;

        // Initialize loading screen
        window.addEventListener('load', function() {
            setTimeout(() => {
                document.getElementById('loadingScreen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                }, 500);
            }, 2000);
        });

        // UI Functions
        function showLevelSelector() {
            document.getElementById('levelSelector').style.display = 'block';
        }

        function selectLevel(level) {
            document.querySelectorAll('.level-option').forEach(el => el.classList.remove('selected'));
            event.target.closest('.level-option').classList.add('selected');
            
            if (game) {
                game.level = level;
            }
        }

        function startGame() {
            const selectedLevel = document.querySelector('.level-option.selected');
            if (!selectedLevel) {
                alert('üéØ Pilih level kesulitan terlebih dahulu!');
                return;
            }
            
            const level = selectedLevel.onclick.toString().match(/selectLevel\('(\w+)'\)/)[1];
            
            document.getElementById('menuScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            document.getElementById('gameTimer').style.display = 'block';
            
            game = new EnhancedUnoGame();
            game.level = level;
            game.gameActive = true;
            
            document.getElementById('currentLevel').textContent = level.toUpperCase();
            
            // Start bot turn if needed
            if (!game.isPlayerTurn) {
                setTimeout(() => game.botTurn(), 1500);
            }
        }

        function showSettings() {
            document.getElementById('menuScreen').style.display = 'none';
            document.getElementById('settingsScreen').style.display = 'block';
            loadSettingsUI();
        }

        function loadSettingsUI() {
            if (game) {
                document.getElementById('sfxVolume').value = game.settings.sfxVolume;
                document.getElementById('musicVolume').value = game.settings.musicVolume;
                document.getElementById('themeSelect').value = game.settings.theme;
                document.getElementById('animationSelect').value = game.settings.animation;
                document.getElementById('autoUnoCall').checked = game.settings.autoUnoCall;
                document.getElementById('showHints').checked = game.settings.showHints;
                document.getElementById('fastMode').checked = game.settings.fastMode;
                document.getElementById('soundEffects').checked = game.settings.soundEffects;
                
                document.getElementById('sfxVolumeDisplay').textContent = game.settings.sfxVolume;
                document.getElementById('musicVolumeDisplay').textContent = game.settings.musicVolume;
            }
        }

        function showStats() {
            document.getElementById('menuScreen').style.display = 'none';
            document.getElementById('statsScreen').style.display = 'block';
            updateStatsDisplay();
        }

        function updateStatsDisplay() {
            const stats = game ? game.stats : JSON.parse(localStorage.getItem('unoGameStats') || '{}');
            const achievements = game ? game.achievements : JSON.parse(localStorage.getItem('unoGameAchievements') || '{}');
            
            document.getElementById('totalWins').textContent = stats.totalWins || 0;
            document.getElementById('totalGames').textContent = stats.totalGames || 0;
            document.getElementById('highScore').textContent = stats.highScore || 0;
            document.getElementById('fastestWin').textContent = stats.fastestWin || '--:--';
            
            const winRate = stats.totalGames > 0 ? Math.round((stats.totalWins / stats.totalGames) * 100) : 0;
            document.getElementById('winRate').textContent = winRate + '%';
            
            // Update achievements display
            const achievementsList = document.getElementById('achievementsList');
            achievementsList.innerHTML = '';
            
            const achievementData = {
                firstWin: { title: 'üéâ Kemenangan Pertama', desc: 'Menang untuk pertama kali' },
                winStreak3: { title: 'üî• Hat Trick', desc: '3 kemenangan berturut-turut' },
                winStreak5: { title: 'üåü Unstoppable', desc: '5 kemenangan berturut-turut' },
                speedWin: { title: '‚ö° Kemenangan Kilat', desc: 'Menang dalam < 2 menit' },
                expertWin: { title: 'üèÜ Master Expert', desc: 'Mengalahkan bot Expert' },
                unoMaster: { title: 'üéØ UNO Master', desc: 'Panggil UNO 10x dengan benar' },
                cardCounter: { title: 'üìä Card Counter', desc: 'Bermain 100 permainan' },
                wildMaster: { title: 'üåà Wild Master', desc: 'Gunakan 5+ kartu spesial' },
                perfectGame: { title: 'üíé Permainan Sempurna', desc: 'Menang tanpa ambil kartu' },
                comebackKing: { title: 'üëë Comeback King', desc: 'Menang dari situasi sulit' }
            };
            
            Object.keys(achievementData).forEach(key => {
                const item = document.createElement('div');
                const isUnlocked = achievements[key];
                item.style.cssText = `
                    padding: 15px;
                    border-radius: 10px;
                    border: 2px solid ${isUnlocked ? '#00ff00' : '#666666'};
                    background: ${isUnlocked ? 'rgba(0,255,0,0.1)' : 'rgba(100,100,100,0.1)'};
                    color: ${isUnlocked ? '#ffffff' : '#aaaaaa'};
                    text-align: center;
                `;
                item.innerHTML = `
                    <div style="font-weight: 800; margin-bottom: 5px;">${achievementData[key].title}</div>
                    <div style="font-size: 0.9rem; opacity: 0.8;">${achievementData[key].desc}</div>
                    <div style="margin-top: 5px; font-size: 0.8rem;">
                        ${isUnlocked ? '‚úÖ Terbuka' : 'üîí Terkunci'}
                    </div>
                `;
                achievementsList.appendChild(item);
            });
        }

        function showRules() {
            const rulesText = `üéÆ CARA BERMAIN UNO CARD GAME

üéØ TUJUAN:
Menjadi pemain pertama yang menghabiskan semua kartu di tangan

üÉè JENIS KARTU:
‚Ä¢ Kartu Angka (0-9): Mainkan sesuai warna atau angka yang sama
‚Ä¢ ‚è≠Ô∏è Skip: Lewati giliran lawan
‚Ä¢ üîÑ Reverse: Balik arah permainan (di 2 pemain = skip)
‚Ä¢ +2 Draw Two: Lawan ambil 2 kartu dan lewati giliran
‚Ä¢ üåà Wild: Pilih warna bebas untuk kartu selanjutnya
‚Ä¢ +4 Wild Draw Four: Pilih warna + lawan ambil 4 kartu

üé≤ CARA BERMAIN:
1. Setiap pemain dapat 7 kartu
2. Mainkan kartu yang sama warna ATAU angka dengan kartu di tengah
3. Jika tidak punya kartu yang bisa dimainkan, ambil dari deck
4. Saat punya 1 kartu terakhir, wajib panggil "UNO"!
5. Lupa panggil UNO = ambil 2 kartu hukuman

üèÜ PENILAIAN:
‚Ä¢ Kartu Angka = Nilai sesuai angka
‚Ä¢ Kartu Aksi = 20 poin
‚Ä¢ Kartu Wild = 50 poin

üí° FITUR BARU:
‚Ä¢ 4 Level kesulitan (Mudah - Expert)
‚Ä¢ Sistem Achievement & Statistik
‚Ä¢ Mode Fast Play untuk permainan cepat
‚Ä¢ Auto UNO Call untuk kemudahan
‚Ä¢ Hints untuk pemain baru
‚Ä¢ Multi-round tournament

üéÆ KONTROL:
‚Ä¢ Klik kartu untuk memainkan
‚Ä¢ D = Draw card (ambil kartu)
‚Ä¢ U = Call UNO
‚Ä¢ P = Pause game
‚Ä¢ ESC = Pause game

üíé TIPS PRO:
‚Ä¢ Simpan kartu wild untuk moment kritis
‚Ä¢ Perhatikan pola permainan bot
‚Ä¢ Gunakan kartu aksi secara strategis
‚Ä¢ Jangan lupa panggil UNO saat punya 2 kartu!
‚Ä¢ Di level Expert, bot sangat pintar - bersiaplah!

Selamat bermain dan semoga beruntung! üçÄ`;

            alert(rulesText);
        }

        function showCardCount() {
            if (!game || !game.gameActive) return;
            
            const playerCount = game.playerCards.length;
            const botCount = game.botCards.length;
            const deckCount = game.deck.length;
            
            game.showNotification(`üìã Kartu: Anda=${playerCount}, Bot=${botCount}, Deck=${deckCount}`, 'info');
        }

        function showGameStats() {
            if (!game) return;
            
            const gameTime = game.getGameTime();
            const cardsPlayed = game.cardsPlayed;
            const specialCards = game.specialCardsPlayed;
            
            const statsText = `üìä STATISTIK GAME SAAT INI

‚è±Ô∏è Waktu Bermain: ${gameTime}
üÉè Kartu Dimainkan: ${cardsPlayed}
‚ú® Kartu Spesial: ${specialCards}
üéØ Level: ${game.level.toUpperCase()}
üèÜ Skor: ${game.score}
üé™ Round: ${game.round}

üí° Status:
${game.isPlayerTurn ? 'üü¢ Giliran Anda' : 'üî¥ Giliran Bot'}
${game.playerCards.length === 1 ? '‚ö†Ô∏è Jangan lupa UNO!' : ''}`;

            alert(statsText);
        }

        function backToMenu() {
            document.getElementById('settingsScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('winScreen').style.display = 'none';
            document.getElementById('statsScreen').style.display = 'none';
            document.getElementById('gameTimer').style.display = 'none';
            document.getElementById('menuScreen').style.display = 'flex';
            
            if (game) {
                game.gameActive = false;
                if (game.gameTimer) {
                    clearInterval(game.gameTimer);
                }
            }
        }

        function pauseGame() {
            if (game) {
                const wasActive = game.gameActive;
                game.gameActive = false;
                
                const result = confirm(`‚è∏Ô∏è PERMAINAN DIJEDA

üéØ Level: ${game.level.toUpperCase()}
üèÜ Skor: ${game.score}
‚è±Ô∏è Waktu: ${game.getGameTime()}
üÉè Kartu Anda: ${game.playerCards.length}
ü§ñ Kartu Bot: ${game.botCards.length}
üé™ Round: ${game.round}

üìä Progres Game:
‚Ä¢ Kartu dimainkan: ${game.cardsPlayed}
‚Ä¢ Kartu spesial: ${game.specialCardsPlayed}

Klik OK untuk melanjutkan permainan...`);
                
                if (result && wasActive) {
                    game.gameActive = true;
                    if (!game.isPlayerTurn) {
                        setTimeout(() => game.botTurn(), 500);
                    }
                }
            }
        }

        function playAgain() {
            document.getElementById('winScreen').style.display = 'none';
            const currentLevel = game.level;
            const currentScore = game.score;
            
            game = new EnhancedUnoGame();
            game.level = currentLevel;
            game.score = currentScore;
            game.gameActive = true;
            
            document.getElementById('currentLevel').textContent = currentLevel.toUpperCase();
            
            if (!game.isPlayerTurn) {
                setTimeout(() => game.botTurn(), 1500);
            }
        }

        function nextRound() {
            document.getElementById('winScreen').style.display = 'none';
            const currentLevel = game.level;
            const currentScore = game.score;
            const currentRound = game.round;
            
            game = new EnhancedUnoGame();
            game.level = currentLevel;
            game.score = currentScore;
            game.round = currentRound + 1;
            game.gameActive = true;
            
            document.getElementById('currentLevel').textContent = currentLevel.toUpperCase();
            document.getElementById('roundNumber').textContent = game.round;
            
            game.showNotification(`üé™ Round ${game.round} dimulai!`, 'success');
            
            if (!game.isPlayerTurn) {
                setTimeout(() => game.botTurn(), 1500);
            }
        }

        function resetStats() {
            const confirmed = confirm('‚ö†Ô∏è RESET STATISTIK\n\nApakah Anda yakin ingin menghapus semua statistik dan achievement?\n\nTindakan ini tidak dapat dibatalkan!');
            
            if (confirmed) {
                localStorage.removeItem('unoGameStats');
                localStorage.removeItem('unoGameAchievements');
                localStorage.removeItem('unoGameSettings');
                localStorage.removeItem('unoCallCount');
                
                alert('‚úÖ Statistik berhasil direset!');
                updateStatsDisplay();
            }
        }

        // Global functions for color selector
        function selectWildColor(color) {
            if (game) {
                game.selectWildColor(color);
            }
        }

        // Settings Event Handlers
        document.addEventListener('DOMContentLoaded', function() {
            // Volume controls
            document.getElementById('sfxVolume').addEventListener('input', function() {
                const value = this.value;
                document.getElementById('sfxVolumeDisplay').textContent = value;
                if (game) {
                    game.settings.sfxVolume = parseInt(value);
                    game.saveSettings();
                }
            });

            document.getElementById('musicVolume').addEventListener('input', function() {
                const value = this.value;
                document.getElementById('musicVolumeDisplay').textContent = value;
                if (game) {
                    game.settings.musicVolume = parseInt(value);
                    game.saveSettings();
                }
            });

            // Theme selector
            document.getElementById('themeSelect').addEventListener('change', function() {
                const theme = this.value;
                const body = document.body;
                
                const themes = {
                    'ocean': 'radial-gradient(ellipse at center, #1e3c72 0%, #2a5298 70%, #1a1a2e 100%)',
                    'forest': 'radial-gradient(ellipse at center, #134e5e 0%, #71b280 70%, #0f2027 100%)',
                    'sunset': 'radial-gradient(ellipse at center, #ff6b35 0%, #f7931e 70%, #8b0000 100%)',
                    'galaxy': 'radial-gradient(ellipse at center, #667eea 0%, #764ba2 70%, #2d1b69 100%)',
                    'classic': 'radial-gradient(ellipse at center, #dc143c 0%, #8b0000 70%, #2d0000 100%)'
                };
                
                body.style.background = themes[theme] || themes.classic;
                
                if (game) {
                    game.settings.theme = theme;
                    game.saveSettings();
                }
            });

            // Animation settings
            document.getElementById('animationSelect').addEventListener('change', function() {
                const level = this.value;
                const root = document.documentElement;
                
                const durations = {
                    'reduced': '0.2s',
                    'minimal': '0.1s',
                    'full': '0.4s'
                };
                
                root.style.setProperty('--animation-duration', durations[level] || durations.full);
                
                if (game) {
                    game.settings.animation = level;
                    game.saveSettings();
                }
            });

            // Game settings checkboxes
            ['autoUnoCall', 'showHints', 'fastMode', 'soundEffects'].forEach(setting => {
                const element = document.getElementById(setting);
                if (element) {
                    element.addEventListener('change', function() {
                        if (game) {
                            game.settings[setting] = this.checked;
                            game.saveSettings();
                        }
                    });
                }
            });
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (!game || !game.gameActive) return;
            
            switch(e.key.toLowerCase()) {
                case 'd':
                    if (game.isPlayerTurn) {
                        game.drawCard();
                    }
                    break;
                    
                case 'u':
                    if (game.playerCards.length === 2 && !game.unoCalledByPlayer) {
                        game.callUno();
                    }
                    break;
                    
                case 'p':
                    pauseGame();
                    break;
                    
                case 'escape':
                    if (document.getElementById('colorSelector').style.display === 'block') {
                        e.preventDefault();
                    } else {
                        pauseGame();
                    }
                    break;
                    
                case 's':
                    showGameStats();
                    break;
                    
                case 'c':
                    showCardCount();
                    break;
            }
        });

        // Touch and mobile optimizations
        if ('ontouchstart' in window) {
            document.addEventListener('touchstart', function() {}, {passive: true});
            
            const gameElements = document.querySelectorAll('.card, .draw-pile, .btn');
            gameElements.forEach(el => {
                el.addEventListener('touchend', function(e) {
                    e.preventDefault();
                });
            });
        }

        // Prevent right-click context menu on game elements
        document.addEventListener('contextmenu', function(e) {
            if (e.target.closest('.card, .draw-pile, .current-card')) {
                e.preventDefault();
            }
        });

        // Focus management
        document.addEventListener('click', function(e) {
            if (e.target.closest('.game-screen')) {
                document.body.focus();
            }
        });

        // Initialize game on page load
        window.addEventListener('load', function() {
            // Create a temporary game instance to initialize sounds and load settings
            const tempGame = new EnhancedUnoGame();
            tempGame.gameActive = false;
            
            // Apply saved theme
            const savedSettings = tempGame.loadSettings();
            const themeSelect = document.getElementById('themeSelect');
            if (themeSelect && savedSettings.theme) {
                themeSelect.value = savedSettings.theme;
                themeSelect.dispatchEvent(new Event('change'));
            }
        });
    </script>
</body>
</html>